#!/bin/bash
HELP_DESC=$(cat << 'EOL'
Direct instance terminal access CLI utility of ClassicDeploy access system
EOL
)
HELP_ARGS=$(cat << 'EOL'
$1                       First PATTERN filtering allowed instances and choose last one
--groups=GROUP1,GROUP2   Filtering by instance groups
--debug                  Verbose output of connection
EOL
)
HELP_EXAMPLES=$(cat << 'EOL'
cldx prod instance_1.2.3.4_22_root
cldx prod instance_1.2.3.4_22_root --groups=gcloud --debug
EOL
)
HELP_ONLY="CLI WEB"

source /var/cld/bin/include/cldfuncs
ARG1=$(echo "${@:1}" | tr ' ' '\n' | grep -v '\--' | head -1)

for i in "$@"
do
case $i in
-g=*|-groups=*|--groups=*) CLD_GROUPS="${i#*=}" ;;
-d|-debug|--debug) VERBOSE=" -v"                ;;
*) ;;
esac
done

echo $1
VM=$(CLOUDS_USER_ALLOWED --groups="${CLD_GROUPS}" | grep -i "$ARG1" | tail -1)
CLD_LOGS
if [ "$VM" ]
then
INSTANCE_GROUP_FUNCS
echo "You had chosen ${GROUP} $VM"
$CLD_VARS
echo
$CLD_TERMINAL
fi
